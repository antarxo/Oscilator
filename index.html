<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>Προσομοίωση Ελατηρίου & Κυκλικό Διάγραμμα με Start/Pause και Reset</title>
  <!-- Φόρτωση της βιβλιοθήκης p5.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <style>
    body { margin: 0; padding: 0; }
    canvas { display: block; }
  </style>
</head>
<body>
<script>
let amplitudeSlider, periodSlider, phaseSlider;
let startTime;
let isRunning = true;
let startPauseButton, resetButton;
let sliderX = 20, sliderY = 20;
let startTimeOffset = 0;

function setup() {
  createCanvas(800, 600);
  
  // Δημιουργία slider για το πλάτος (A)
  amplitudeSlider = createSlider(20, 200, 100, 1);
  amplitudeSlider.position(sliderX, sliderY);
  amplitudeSlider.style('width', '160px');

  // Δημιουργία slider για την περίοδο (T)
  periodSlider = createSlider(0.5, 5, 2, 0.1);
  periodSlider.position(sliderX, sliderY + 30);
  periodSlider.style('width', '160px');

  // Δημιουργία slider για την αρχική φάση (φ)
  phaseSlider = createSlider(0, TWO_PI, 0, 0.01);
  phaseSlider.position(sliderX, sliderY + 60);
  phaseSlider.style('width', '160px');

  // Δημιουργία κουμπιού Start/Pause
  startPauseButton = createButton('Pause');
  startPauseButton.position(sliderX, sliderY + 100);
  startPauseButton.mousePressed(toggleSimulation);

  // Δημιουργία κουμπιού Reset
  resetButton = createButton('Reset');
  resetButton.position(sliderX + 80, sliderY + 100);
  resetButton.mousePressed(resetSimulation);

  startTime = millis();
}

function draw() {
  background(240);
  
  // Ανάγνωση τιμών από τους slider
  let A = amplitudeSlider.value();
  let T = periodSlider.value();
  let phi = phaseSlider.value();

  // Υπολογισμός χρόνου και γωνίας
  let t = (millis() - startTime) / 1000;
  let omega = TWO_PI / T;
  let theta = omega * t + phi;
  
  // --- Κυκλικό Διάγραμμα (Phase Diagram) ---
  push();
  let centerX = 100;
  let centerY = height / 2;
  
  // Σχεδίαση κύκλου με ακτίνα ίση με το πλάτος (A)
  stroke(0);
  noFill();
  ellipse(centerX, centerY, 2 * A, 2 * A);
  
  // Σχεδίαση αξόνων x και y στο κέντρο του κύκλου
  stroke(150);
  // Επέκταση του οριζόντιου άξονα x προς τα δεξιά (αυτός ο άξονας ξεπερνά το σώμα)
  line(centerX - A - 20, centerY, centerX + A + 80, centerY);
  line(centerX, centerY - A - 10, centerX, centerY + A + 10);
  
  // Σχεδίαση ακτίνας που ακολουθεί το κόκκινο σώμα
  stroke(0, 150, 0);
  line(centerX, centerY, centerX + A * sin(theta), centerY + A * cos(theta));
  
  // Σχεδίαση του μικρότερου κόκκινου σώματος που διαγράφει την τροχιά
  fill(255, 0, 0);
  noStroke();
  let circleX = centerX + A * sin(theta);
  let circleY = centerY + A * cos(theta);
  ellipse(circleX, circleY, 15, 15);
  pop();
  
  // --- Προσομοίωση Ελατηρίου-Σώματος ---
  push();
  let springX = width * 0.75;
  let fixedY = 50;      // Σταθερή θέση (ταβάνι)
  let eqY = height / 2; // Θέση ισορροπίας του σώματος στο κέντρο του καμβά
  let baseLength = eqY - fixedY;
  
  // Υπολογισμός κατακόρυφης μετατόπισης με ταλάντωση
  let springDisplacement = A * cos(theta);
  let massY = fixedY + baseLength + springDisplacement;
  
  // Σχεδίαση ελατηρίου με περισσότερες σπείρες
  stroke(0);
  noFill();
  beginShape();
  vertex(springX, fixedY);
  let numCoils = 12;
  let coilLength = (massY - fixedY) / numCoils;
  for (let i = 1; i < numCoils; i++) {
    let xOffset = (i % 2 === 0) ? 20 : -20;
    vertex(springX + xOffset, fixedY + i * coilLength);
  }
  vertex(springX, massY);
  endShape();
  
  // Σχεδίαση του σώματος που ταλαντεύεται (κεντραρισμένο πάνω στον οριζόντιο άξονα)
  fill(0, 0, 255);
  noStroke();
  ellipse(springX, massY, 40, 40);
  pop();
  
  // Εμφάνιση των ετικετών των επιλογέων
  fill(0);
  noStroke();
  text("Πλάτος (A): " + A, sliderX + 180, sliderY + 15);
  text("Περίοδος (T): " + nf(T, 1, 2) + " s", sliderX + 180, sliderY + 45);
  text("Αρχική Φάση (φ): " + nf(phi, 1, 2) + " rad", sliderX + 180, sliderY + 75);
}

function toggleSimulation() {
  if (isRunning) {
    // Αποθήκευση του χρόνου που έχει παρέλθει μέχρι το παύσιμο σημείο
    startTimeOffset = millis() - startTime;
    noLoop();
    startPauseButton.html('Start');
  } else {
    // Συνεχίζουμε το χρόνο λαμβάνοντας υπόψη το offset
    startTime = millis() - startTimeOffset;
    loop();
    startPauseButton.html('Pause');
  }
  isRunning = !isRunning;
}

function resetSimulation() {
  // Επαναφορά του χρόνου στην αρχή της προσομοίωσης
  startTime = millis();
  startTimeOffset = 0;
}
</script>
</body>
</html>
